!function(){var a={submitFlag:!1,email:"",captcha:"",d_email:"",email_captcha:"",new_pw:"",repeat_new_pw:"",init:function(){a.bindEvent()},bindEvent:function(){$("#captcha_img").click(function(){var e=$(this),a=gppTool.randomNum(10);e.attr("src","../common/captcha?"+a)}),$("#email").bind("input propertychange",function(){var e=$(this).val();""===$.trim(e)?($("#email_prompt").empty(),$("#email").removeClass("bd-red")):/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(e)?($("#email_prompt").empty(),$("#email").removeClass("bd-red")):($("#email_prompt").text("* 请输入正确的邮箱"),$("#email").addClass("bd-red"))}),$("#captcha").bind("input propertychange",function(){4===$(this).val().length&&($("#captcha_prompt").empty(),$("#captcha").removeClass("bd-red"))}),$("#email_captcha").bind("input propertychange",function(){6===$(this).val().length&&($("#email_captcha_prompt").empty(),$("#email_captcha").removeClass("bd-red"))}),$("#new_pw").bind("input propertychange",function(){var e=$(this).val();""===$.trim(e)?($("#pw_prompt").empty(),$("#new_pw").removeClass("bd-red")):6<=e.length&&e.length<=32?($("#pw_prompt").empty(),$("#new_pw").removeClass("bd-red")):$("#pw_prompt").text("* 密码长度6-32个字符")}),$("#repeat_new_pw").bind("input propertychange",function(){var e=$("#new_pw").val(),a=$(this).val();""===$.trim(a)?($("#repeat_pw_prompt").empty(),$("#repeat_new_pw").removeClass("bd-red")):e.length!==a.length||e!==a?$("#repeat_pw_prompt").text("* 两次输入的密码不一致"):($("#repeat_pw_prompt").empty(),$("#repeat_new_pw").removeClass("bd-red"))}),$("#confirmEmail_btn").click(function(){return a.checkForm()&&a.selectEmailForm(),!1}),$("#sendEmail_btn").click(function(){var e=$("#d_email").val();return""===$.trim(e)?alert("网络异常，请刷新页面重试"):($(this).attr("disabled","true"),a.sendEmailFrom()),!1}),$("#sendEmail_next").click(function(){return a.sendEmailCheckForm()&&a.getCaptchaForm(),!1}),$("#sub").click(function(){return a.checkPWform()&&a.submitForm(),!1})},selectEmailForm:function(){return!!a.checkForm()&&(!0!==a.submitFlag&&(a.submitFlag=!0,void $.get("/member/selectEmail",{email:a.email,captcha:a.captcha},function(e){return-1===e.code?($("#captcha_prompt").text("* "+e.msg),$("#captcha").addClass("bd-red"),$("#captcha").focus()):0===e.code?($("#email_prompt").text("* "+e.msg),$("#email").addClass("bd-red"),$("#email").focus()):200===e.code&&($("#d_email").val(e.email),$("#confirmEmail_form").addClass("hidden"),$("#sendEmail_form").removeClass("hidden")),!1}).complete(function(){a.submitFlag=!1})))},sendEmailFrom:function(){a.d_email=$("#d_email").val();if(!0===a.submitFlag)return!1;a.submitFlag=!0,$.get("/member/sendEmail",{email:a.d_email},function(e){if(200!==e.code)return alert("发送邮件失败"),!1;var a=119;return $("#sendEmail_btn").text("("+a+")重发"),timer=setInterval(function(){0<a?(a--,$("#sendEmail_btn").text("("+a+")重发")):(clearTimeout(timer),$("#sendEmail_btn").removeAttr("disabled"),$("#sendEmail_btn").text("获取验证码"),$("#email_captcha_prompt").empty())},1e3),$("#email_captcha_prompt").text(e.msg),!1}).error(function(){$("#sendEmail_btn").removeAttr("disabled")}).complete(function(){a.submitFlag=!1})},getCaptchaForm:function(){return!!a.sendEmailCheckForm()&&(!0!==a.submitFlag&&(a.submitFlag=!0,void $.get("/member/checkCaptcha",{email:a.d_email,email_captcha:a.email_captcha},function(e){return-1===e.code?($("#email_captcha_prompt").text("* "+e.msg),$("#email_captcha").addClass("bd-red"),$("#email_captcha").focus()):200===e.code&&($("#sendEmail_form").addClass("hidden"),$("#updatePW_form").removeClass("hidden")),!1}).complete(function(){a.submitFlag=!1})))},submitForm:function(){return!!a.checkPWform()&&(!0!==a.submitFlag&&(a.submitFlag=!0,void $.post("/member/forget_pw",{user_pw:$.md5(a.repeat_new_pw),user_email:a.email},function(e){return 200===e.code&&(alert("修改密码成功！"),!(window.location.href="/member/login"))}).complete(function(){a.submitFlag=!1})))},checkForm:function(){return a.email=$("#email").val(),a.captcha=$("#captcha").val(),/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(a.email)?""===$.trim(a.captcha)?($("#captcha_prompt").text("* 请输入验证码"),$("#captcha").addClass("bd-red"),$("#captcha").focus(),!1):(4!==a.captcha.length&&($("#captcha_prompt").text("* 验证码不正确"),$("#captcha").addClass("bd-red"),$("#captcha").focus()),!0):($("#email_prompt").text("* 请输入正确的邮箱"),$("#email").addClass("bd-red"),$("#email").focus(),!1)},sendEmailCheckForm:function(){return a.d_email=$("#d_email").val(),a.email_captcha=$("#email_captcha").val(),""===$.trim(a.d_email)?(alert("网络异常，请刷新页面重试"),!1):""===$.trim(a.email_captcha)?($("#email_captcha_prompt").text("* 请输入邮箱验证"),$("#email_captcha").addClass("bd-red"),$("#email_captcha").focus(),!1):6===a.email_captcha.length||($("#email_captcha_prompt").text("* 邮箱验证不正确"),$("#email_captcha").addClass("bd-red"),$("#email_captcha").focus(),!1)},checkPWform:function(){return a.new_pw=$("#new_pw").val(),a.repeat_new_pw=$("#repeat_new_pw").val(),""===$.trim(a.new_pw)?($("#pw_prompt").text("* 请输入新密码"),$("#new_pw").addClass("bd-red"),$("#new_pw").focus(),!1):a.new_pw.length<6||32<a.new_pw.length?($("#pw_prompt").text("* 密码长度6-32个字符"),$("#new_pw").addClass("bd-red"),$("#new_pw").focus(),!1):a.new_pw===a.repeat_new_pw||($("#repeat_pw_prompt").text("两次输入的密码不一致"),$("#repeat_new_pw").addClass("bd-red"),$("#repeat_new_pw").focus(),!1)}};window.pageScript=new a.init}();