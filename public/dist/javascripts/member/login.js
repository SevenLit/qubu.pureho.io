!function(){var e={submitFlag:!1,username:"",passwd:"",captcha:"",init:function(){"true"===gppTool.getCookie("login_count")&&$("#captcha_bar").removeClass("hidden"),e.bindEvent()},bindEvent:function(){$("#captcha_img").click(function(){var a=$(this),e=gppTool.randomNum(10);a.attr("src","../common/captcha?"+e)}),$("#username").bind("input propertychange",function(){var a=$("#username").val();""===$.trim(a)?($("#user_prompt").empty(),$("#username").removeClass("bd-red")):4<=a.length&&a.length<=32?($("#user_prompt").empty(),$("#username").removeClass("bd-red")):($("#username").addClass("bd-red"),$("#user_prompt").text("* 用户名长度4-32个字符"))}),$("#passwd").bind("input propertychange",function(){var a=$("#passwd").val();""===$.trim(a)?($("#pw_prompt").empty(),$("#passwd").removeClass("bd-red")):6<=a.length&&a.length<=32?($("#pw_prompt").empty(),$("#passwd").removeClass("bd-red")):($("#pw_prompt").text("* 密码长度6-32个字符"),$("#passwd").addClass("bd-red"))}),$("#captcha").bind("input propertychange",function(){4===$("#captcha").val().length&&($("#captcha_prompt").empty(),$("#captcha").removeClass("bd-red"))}),$("#sub").click(function(){return e.checkForm()&&e.submitForm(),!1}),$("#login_form").submit(function(){return e.checkForm()&&e.submitForm(),!1})},checkForm:function(){return e.username=$("#username").val(),e.passwd=$("#passwd").val(),e.captcha=$("#captcha").val(),""===$.trim(e.username)?($("#user_prompt").text("* 用户名不能为空"),$("#username").addClass("bd-red"),$("#username").focus(),!1):e.username.length<4||32<e.username.length?($("#user_prompt").text("* 用户名不正确"),$("#username").addClass("bd-red"),$("#username").focus(),!1):""===$.trim(e.passwd)?($("#pw_prompt").text("* 密码不能为空"),$("#passwd").addClass("bd-red"),$("#passwd").focus(),!1):e.passwd.length<6||32<e.passwd.length?($("#pw_prompt").text("* 密码不正确"),$("#passwd").addClass("bd-red"),$("#passwd").focus(),!1):!(!$("#captcha_bar").hasClass("hidden")&&4!==e.captcha.length)||($("#captcha_prompt").text("* 验证码不正确"),$("#captcha").addClass("bd-red"),$("#captcha").focus(),!1)},submitForm:function(){return!!e.checkForm()&&(!0!==e.submitFlag&&(e.submitFlag=!0,void $.ajax({url:"/member/login",type:"POST",dataType:"json",async:!0,data:{user_name:e.username,user_pw:$.md5(e.passwd),captcha:e.captcha},success:function(a){return e.submitFlag=!1,3<=a.login_count&&(gppTool.setCookie("login_count","true","86400"),$("#captcha_bar").removeClass("hidden")),-1===a.code?($("#captcha_prompt").text("* 验证码不正确"),$("#captcha").addClass("bd-red"),$("#captcha").focus(),!1):0===a.code?(alert(a.msg),!1):!(window.location="/")}})))}};window.pageScript=new e.init}();